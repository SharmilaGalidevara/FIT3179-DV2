<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>FIT3179 - Week 10 Homework</title>
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@7"></script>
  <style>
    body { 
      font-family: Arial, sans-serif; 
      margin: 12px;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      line-height: 1.6;
      color: #333;
    }
    .viz-container {
      margin-bottom: 40px;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.1);
      padding: 20px;
    }
    h1 { 
      font-family: Georgia, 'Times New Roman', Times, serif;
      color: #2c3e50;
      text-align: center;
      font-weight: 600;
      line-height: 1.3;
      margin-bottom: 20px;
    }
    h2, h3, h4, h5, h6 {
      font-family: 'Segoe UI', Roboto, -apple-system, BlinkMacSystemFont, sans-serif;
      color: #2c3e50;
      text-align: center;
      font-weight: 600;
      line-height: 1.3;
    }
    h1 { 
      margin-bottom: 5px;
      font-size: 2.2em;
    }
    h2 {
      margin-top: 30px;
      margin-bottom: 20px;
      font-size: 1.5em;
      color: #34495e;
      padding-bottom: 10px;
      border-bottom: 2px solid #ecf0f1;
    }
    .meta {
      font-size: 0.95rem;
      color: #555;
      margin: 10px 0 20px;
      text-align: center;
      line-height: 1.5;
    }
    .meta-card {
      position: fixed;
      top: 12px;
      right: 12px;
      background: #ffffff;
      border: 1px solid #ddd;
      border-radius: 6px;
      padding: 12px 15px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      font-size: 0.9rem;
      color: #333;
      z-index: 1000;
    }
    .meta-card h2 {
      font-size: 1.1rem;
      margin: 0 0 8px 0;
      text-align: center;
      padding: 0;
      border: none;
    }
    .meta-card .row {
      margin: 4px 0;
      line-height: 1.4;
    }
    .meta-card strong {
      color: #2c3e50;
    }
    .description {
      background-color: #f8f9fa;
      border-left: 4px solid #3498db;
      padding: 12px 15px;
      margin: 20px 0;
      border-radius: 0 4px 4px 0;
    }
    .description p {
      margin: 5px 0;
    }
    #bubble-plot, #map {
      display: flex;
      justify-content: center;
      margin: 20px 0;
    }
    .vega-bind {
      display: flex;
      justify-content: center;
      margin: 15px 0;
      align-items: center;
    }
    .vega-bind label {
      margin-right: 10px;
      font-weight: bold;
      color: #34495e;
    }
    .vega-bind select {
      padding: 5px 10px;
      border-radius: 4px;
      border: 1px solid #ddd;
      background-color: white;
    }
  </style>
</head>
<body>
  <h1>Malaysia's Protected Areas & Economic Indicators</h1>

  <div class="viz-container">
    <h2>State-level Economic Indicators</h2>
    <div class="description">
      <p>This bubble plot shows the relationship between median income and GDP across Malaysian states, with bubble size representing population.</p>
      <p>Use the dropdown to filter by year. Hover over bubbles to see detailed information about each state.</p>
    </div>
    <div id="bubble-plot"></div>
  </div>

  <div class="viz-container">
    <h2>Malaysia National Parks & Biodiversity</h2>
    <div class="description">
      <p>Map shows Malaysia's national parks and biodiversity context nationwide.</p>
      <p>Circle size encodes protected area size in square kilometers. Hover over circles to see park details.</p>
    </div>
    <div id="map"></div>
  </div>

  <div class="meta-card">
    <h2>FIT3179 - Week 10</h2>
    <div class="row"><strong>Name:</strong> Sharmila Galidevara</div>
    <div class="row"><strong>Student ID:</strong> 34327851</div>
  </div>

  <script>
  // Bubble Plot Specification
  const bubbleSpec = {
    "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
    "description": "Bubble plot showing relationship between median income and GDP by Malaysian state",
    "width": 800,
    "height": 500,
    "padding": 40,
    "background": "#ffffff",
    "data": {
      "values": [
        // 2018 Data
        {"state":"Kuala Lumpur","year":2018,"median_income":9200,"gdp":110000,"population":1750000,"parks":5},
        {"state":"Selangor","year":2018,"median_income":9200,"gdp":82000,"population":6300000,"parks":8},
        {"state":"Johor","year":2018,"median_income":6700,"gdp":78000,"population":3700000,"parks":6},
        {"state":"Sabah","year":2018,"median_income":4200,"gdp":32000,"population":3800000,"parks":12},
        {"state":"Sarawak","year":2018,"median_income":4700,"gdp":37000,"population":2700000,"parks":15},
        {"state":"Pulau Pinang","year":2018,"median_income":6500,"gdp":42000,"population":1750000,"parks":4},
        {"state":"Perak","year":2018,"median_income":4000,"gdp":28000,"population":2450000,"parks":7},
        {"state":"Pahang","year":2018,"median_income":4300,"gdp":26000,"population":1650000,"parks":10},
        {"state":"Negeri Sembilan","year":2018,"median_income":4900,"gdp":20000,"population":1150000,"parks":3},
        {"state":"Kedah","year":2018,"median_income":4200,"gdp":19000,"population":2150000,"parks":4},
        {"state":"Kelantan","year":2018,"median_income":3600,"gdp":14000,"population":1850000,"parks":5},
        {"state":"Terengganu","year":2018,"median_income":5800,"gdp":17000,"population":1250000,"parks":6},
        {"state":"Perlis","year":2018,"median_income":4300,"gdp":4500,"population":250000,"parks":2},
        {"state":"Melaka","year":2018,"median_income":6100,"gdp":19000,"population":900000,"parks":3},
        {"state":"W.P. Putrajaya","year":2018,"median_income":9500,"gdp":22000,"population":110000,"parks":1},
        {"state":"W.P. Labuan","year":2018,"median_income":6600,"gdp":4000,"population":95000,"parks":1},
        
        // 2019 Data
        {"state":"Kuala Lumpur","year":2019,"median_income":9500,"gdp":115000,"population":1770000,"parks":5},
        {"state":"Selangor","year":2019,"median_income":9500,"gdp":86000,"population":6400000,"parks":8},
        {"state":"Johor","year":2019,"median_income":6900,"gdp":82000,"population":3750000,"parks":6},
        {"state":"Sabah","year":2019,"median_income":4350,"gdp":33500,"population":3850000,"parks":12},
        {"state":"Sarawak","year":2019,"median_income":4850,"gdp":38500,"population":2850000,"parks":15},
        {"state":"Pulau Pinang","year":2019,"median_income":6700,"gdp":43500,"population":1770000,"parks":4},
        {"state":"Perak","year":2019,"median_income":4150,"gdp":29000,"population":2470000,"parks":7},
        {"state":"Pahang","year":2019,"median_income":4450,"gdp":27000,"population":1670000,"parks":10},
        {"state":"Negeri Sembilan","year":2019,"median_income":5050,"gdp":21000,"population":1170000,"parks":3},
        {"state":"Kedah","year":2019,"median_income":4350,"gdp":19500,"population":2170000,"parks":4},
        {"state":"Kelantan","year":2019,"median_income":3700,"gdp":14500,"population":1870000,"parks":5},
        {"state":"Terengganu","year":2019,"median_income":6000,"gdp":17500,"population":1270000,"parks":6},
        {"state":"Perlis","year":2019,"median_income":4450,"gdp":4750,"population":255000,"parks":2},
        {"state":"Melaka","year":2019,"median_income":6300,"gdp":19500,"population":915000,"parks":3},
        {"state":"W.P. Putrajaya","year":2019,"median_income":9800,"gdp":23500,"population":115000,"parks":1},
        {"state":"W.P. Labuan","year":2019,"median_income":6800,"gdp":4200,"population":98000,"parks":1},
        
        // 2020-2022 Data (from previous, with consistent growth)
        {"state":"Kuala Lumpur","year":2020,"median_income":9800,"gdp":120000,"population":1800000,"parks":5},
        {"state":"Selangor","year":2020,"median_income":9800,"gdp":90000,"population":6500000,"parks":8},
        {"state":"Johor","year":2020,"median_income":7100,"gdp":85000,"population":3800000,"parks":6},
        {"state":"Sabah","year":2020,"median_income":4500,"gdp":35000,"population":3900000,"parks":12},
        {"state":"Sarawak","year":2020,"median_income":5000,"gdp":40000,"population":2800000,"parks":15},
        {"state":"Pulau Pinang","year":2020,"median_income":6900,"gdp":45000,"population":1800000,"parks":4},
        {"state":"Perak","year":2020,"median_income":4300,"gdp":30000,"population":2500000,"parks":7},
        {"state":"Pahang","year":2020,"median_income":4600,"gdp":28000,"population":1700000,"parks":10},
        {"state":"Negeri Sembilan","year":2020,"median_income":5200,"gdp":22000,"population":1200000,"parks":3},
        {"state":"Kedah","year":2020,"median_income":4500,"gdp":20000,"population":2200000,"parks":4},
        {"state":"Kelantan","year":2020,"median_income":3800,"gdp":15000,"population":1900000,"parks":5},
        {"state":"Terengganu","year":2020,"median_income":6200,"gdp":18000,"population":1300000,"parks":6},
        {"state":"Perlis","year":2020,"median_income":4600,"gdp":5000,"population":260000,"parks":2},
        {"state":"Melaka","year":2020,"median_income":6500,"gdp":20000,"population":930000,"parks":3},
        {"state":"W.P. Putrajaya","year":2020,"median_income":10000,"gdp":25000,"population":120000,"parks":1},
        {"state":"W.P. Labuan","year":2020,"median_income":7000,"gdp":4500,"population":100000,"parks":1}
      ]
    },
    "params": [
      {
        "name": "yearFilter",
        "value": 2020,
        "bind": {
          "input": "select",
          "name": "Select Year: ",
          "options": [2018, 2019, 2020],
          "labels": ["2018", "2019", "2020"]
        }
      }
    ],
    "transform": [
      {"filter": {"field": "year", "equal": {"expr": "yearFilter"}}},
      {"calculate": "datum.gdp * 1000", "as": "gdp_value"},
      {"calculate": "datum.median_income * 12", "as": "annual_income"}
    ],
    "layer": [
      {
        "mark": {
          "type": "circle",
          "opacity": 0.8,
          "stroke": "#2c3e50",
          "strokeWidth": 1,
          "cursor": "pointer"
        },
        "encoding": {
          "x": {
            "field": "median_income",
            "type": "quantitative",
            "title": "Median Monthly Income (MYR)",
            "scale": {"zero": false, "nice": true},
            "axis": {"grid": true, "tickCount": 5}
          },
          "y": {
            "field": "gdp",
            "type": "quantitative",
            "title": "GDP (MYR Million)",
            "scale": {"zero": false, "nice": true},
            "axis": {"grid": true, "tickCount": 5}
          },
          "size": {
            "field": "population",
            "type": "quantitative",
            "title": "Population",
            "scale": {"range": [400, 4000]},
            "legend": {
              "title": "Population",
              "orient": "right",
              "format": ",.0s"
            }
          },
          "color": {
            "value": "#3498db"
          },
          "tooltip": [
            {"field": "state", "type": "nominal", "title": "State"},
            {"field": "year", "type": "nominal", "title": "Year"},
            {"field": "median_income", "type": "quantitative", "title": "Median Income (MYR)", "format": ",.0f"},
            {"field": "annual_income", "type": "quantitative", "title": "Annual Income (MYR)", "format": ",.0f"},
            {"field": "gdp_value", "type": "quantitative", "title": "GDP (MYR)", "format": ",.0f"},
            {"field": "population", "type": "quantitative", "title": "Population", "format": ","},
            {"field": "parks", "type": "quantitative", "title": "Number of Parks"}
          ]
        }
      },
      {
        "mark": {
          "type": "text",
          "align": "left",
          "dx": 8,
          "dy": -8,
          "fontWeight": "bold",
          "fontSize": 11
        },
        "encoding": {
          "x": {"field": "median_income", "type": "quantitative"},
          "y": {"field": "gdp", "type": "quantitative"},
          "text": {"field": "state", "type": "nominal"},
          "opacity": {"value": 0.9}
        }
      }
    ],
    "config": {
      "view": {"stroke": "transparent"},
      "axis": {
        "labelFontSize": 11,
        "titleFontSize": 13,
        "titleFontWeight": "normal",
        "titlePadding": 10
      },
      "legend": {
        "labelFontSize": 11,
        "titleFontSize": 12,
        "titleFontWeight": "normal"
      },
      "title": {"fontSize": 16, "offset": 20}
    }
  };

  // Map Specification (from Week 9)
  const mapSpec = {
    "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
    "width": 900,
    "height": 600,
    "projection": { "type": "mercator", "center": [109, 4], "scale": 2200 },
    "layer": [
      // ocean background (sphere)
      {
        "data": { "sphere": true },
        "mark": { "type": "geoshape", "fill": "#e6f3ff", "stroke": "#cfe8ff", "strokeWidth": 0.6 }
      },
      // graticule
      {
        "data": { "graticule": true },
        "mark": { "type": "geoshape", "stroke": "#bdbdbd", "strokeWidth": 0.6, "fill": null }
      },
      // malaysia outline 
      {
        "data": {
          "url": "https://raw.githubusercontent.com/SharmilaGalidevara/FIT3179-DV2/main/data/malaysia_geo.json",
          "format": { "type": "json" }
        },
        "mark": {
          "type": "geoshape",
          "fill": "#ffffff",
          "stroke": "#000000",
          "strokeWidth": 1.8,
          "strokeOpacity": 1
        }
      },
      // national parks as proportional circles
      {
        "data": {
          "url": "https://raw.githubusercontent.com/SharmilaGalidevara/FIT3179-DV2/main/malaysia_parks_week9.csv",
          "format": { "type": "csv" }
        },
        "transform": [
          { "calculate": "datum.Area_k2", "as": "Area_k2_color" }
        ],
        "mark": { 
          "type": "circle", 
          "opacity": 0.8, 
          "stroke": "#2f4f2f", 
          "strokeWidth": 1,
          "cursor": "pointer"
        },
        "encoding": {
          "longitude": { "field": "Centroid_Lon", "type": "quantitative" },
          "latitude":  { "field": "Centroid_Lat", "type": "quantitative" },
          "size": {
            "field": "Area_k2",
            "type": "quantitative",
            "scale": { "range": [40, 1600] },
            "legend": { 
              "title": "Area (km²)", 
              "orient": "right", 
              "format": ",d",
              "titleFontSize": 12,
              "labelFontSize": 11
            }
          },
          "color": {
            "field": "Area_k2_color",
            "type": "quantitative",
            "title": "Area (km²)",
            "scale": { 
              "scheme": "greens", 
              "reverse": false 
            },
            "legend": { 
              "title": "Area (km²)", 
              "orient": "right", 
              "gradientLength": 160, 
              "format": ",d",
              "titleFontSize": 12,
              "labelFontSize": 11
            }
          },
          "tooltip": [
            {"field": "Park_Name", "type": "nominal", "title": "Protected Area"},
            {"field": "State", "type": "nominal", "title": "State(s)"},
            {"field": "Area_k2", "type": "quantitative", "title": "Area (km²)", "format": ",d"},
            {"field": "Species_Count", "type": "quantitative", "title": "Species count", "format": ",d"},
            {"field": "Species_Density", "type": "quantitative", "title": "Species/km²", "format": ".2f"}
          ]
        }
      }
    ],
    "config": {
      "view": {"stroke": "transparent"},
      "title": {"fontSize": 18, "offset": 20}
    }
  };

  // Embed the visualizations
  vegaEmbed('#bubble-plot', bubbleSpec, {actions: false})
    .then(result => console.log('Bubble plot loaded'))
    .catch(console.error);

  vegaEmbed('#map', mapSpec, {actions: false})
    .then(result => console.log('Map loaded'))
    .catch(console.error);
  </script>
</body>
</html>
